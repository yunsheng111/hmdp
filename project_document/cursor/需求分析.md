# 需求分析：普通优惠券库存管理功能

**[2024-07-16 10:23:00 +08:00]**

## 1. 需求背景

当前系统中只有秒杀券支持设置和更新库存，普通优惠券不支持这一功能。从错误日志可以看出，当尝试更新普通优惠券的库存时，系统会抛出异常："只有秒杀券才能更新库存"。

## 2. 需求描述

为普通优惠券添加库存管理功能，使商家能够：
1. 创建普通优惠券时设置初始库存
2. 编辑普通优惠券时修改库存
3. 使用库存管理功能调整普通优惠券的库存（增加/设置）

## 3. 系统现状分析

### 3.1 数据库结构
- `tb_voucher` 表：存储优惠券基本信息，但没有库存字段
- `tb_seckill_voucher` 表：存储秒杀券的特殊信息，包含库存字段
- 系统没有存储普通优惠券库存的表

### 3.2 代码结构
- `Voucher` 实体类：包含一个非持久化的 `stock` 字段（@TableField(exist = false)）
- `VoucherServiceImpl.updateVoucherStock()` 方法：当前只允许更新秒杀券库存
- 前端界面已经为所有类型的优惠券提供了库存显示和调整的UI

## 4. 问题根源

1. 数据库中没有存储普通优惠券库存的表或字段
2. 代码逻辑中限制了只有秒杀券才能设置和更新库存

## 5. 解决方案

需要创建一个新的数据库表 `tb_voucher_stock` 用于存储普通优惠券的库存信息，并修改相关代码以支持普通优惠券的库存管理功能。